advanced_music_hack_bind(){
  ([ -f "$1" ] && [ -f "$2" ] && [ -f "$3" ]) || return 1
  mount_bind "$1" "$2" && echo "overmounted $2 on $1" || return 1
  mount_bind "$1" "$3" && echo "overmounted $3 on $1" || return 1
  return 0
}
advanced_music_hack(){
  echo "starting advanced music hack..."
  local music_path="$mountpoint/media/hakchi/menu_music"
  [ ! -d "$music_path" ] && music_path="$installpath/menu_music"
  
  local wav_file="$music_path/$(ls -1 $music_path/*.wav $music_path/*.WAV | head -$((${RANDOM} % `ls -1 $music_path/*.wav $music_path/*.WAV | wc -l` + 1)) | tail -1)"
  
  if [ -f "$wav_file" ]; then
    echo "WAV files detected..."
    
    # NES Mini
    advanced_music_hack_bind \
      "$wav_file" \
      "$mountpoint/usr/share/clover-ui/resources/sounds/hvc/bgm_boot.wav" \
      "$mountpoint/usr/share/clover-ui/resources/sounds/hvc/bgm_home.wav"

    # SNES Mini (USA)
    advanced_music_hack_bind \
      "$wav_file" \
      "$mountpoint/usr/share/ui/snes-usa/resources/sounds/hvc/bgm_boot.wav" \
      "$mountpoint/usr/share/ui/snes-usa/resources/sounds/hvc/bgm_home.wav"

    # SNES Mini (EUR)
    advanced_music_hack_bind \
      "$wav_file" \
      "$mountpoint/usr/share/ui/snes-eur/resources/sounds/hvc/bgm_boot.wav" \
      "$mountpoint/usr/share/ui/snes-eur/resources/sounds/hvc/bgm_home.wav"

    # Super Famicom Mini (JAP)
    advanced_music_hack_bind \
      "$wav_file" \
      "$mountpoint/usr/share/ui/shvc/resources/sounds/hvc/bgm_boot.wav" \
      "$mountpoint/usr/share/ui/shvc/resources/sounds/hvc/bgm_home.wav"
  fi
}
advanced_music_hack # &> /media/music_hack.log
